# probpf

[English](README_en.md) | **中文**

ProBPF 是一个基于 eBPF 和 Go 构建的高性能主机网络活动监控工具。它提供实时的网络连接跟踪、流量统计和流分析，并通过现代化的、移动端友好的 Web UI 进行可视化展示。

## 功能特性

- **eBPF 监控**: 使用 XDP 和 TC 高效跟踪 IPv4/IPv6 的 TCP 和 UDP 流量。
- **实时 Web UI**:
  - **仪表盘**: 概览所有活跃客户端，支持排序和搜索。
  - **客户端详情**: 深入查看每个连接（流）的统计信息。
  - **会话与全局统计**: 分别跟踪当前会话带宽使用量与历史总量。
  - **移动端优化**: 全响应式设计，适配移动设备的卡片视图和触控操作。
  - **深色模式**: 支持自动或手动切换明暗主题。
- **高级流量分析**:
  - **流时长**: 精确跟踪连接持续时间。
  - **协议过滤**: 按协议、远程 IP 或端口进行过滤。
  - **CIDR 过滤**: 支持通过 `-lan` (自动检测) 或 `-cidr` (手动指定) 忽略特定网段的流量（如内网流量）。
- **资源高效**:自动连接清理，低开销的 eBPF 探针。

## 前置要求

- Linux 内核 >= 5.4 (建议支持 BTF)
- LLVM/Clang 用于 eBPF 编译
- Go >= 1.21

## 安装

1. 克隆仓库:

```bash
git clone https://github.com/kisy/probpf.git
cd probpf
```

2. 安装依赖 (Ubuntu/Debian):

```bash
apt-get install clang llvm libbpf-dev
```

3. 编译项目 (使用提供的脚本):

```bash
./build.sh
```

该脚本会自动处理 eBPF 生成以及 AMD64 和 ARM64 架构的 Go 编译。

## 使用方法

### Web UI 模式 (推荐)

启动监控代理并启用 Web UI：

```bash
sudo ./bin/probpf-amd64 -i eth0 -l :8000
```

访问 `http://<your-server-ip>:8000` 查看仪表盘。

### 局域网监控与过滤

默认情况下，ProBPF 会自动忽略本地局域网流量。

**开启 LAN 监控:**

```bash
sudo ./bin/probpf-amd64 -i eth0 -l :8000 -lan
```

**自定义忽略网段:**
如果不使用 `-lan`，通过 `-cidr` 手动指定要忽略的网段（替代自动检测）：

```bash
sudo ./bin/probpf-amd64 -i eth0 -l :8000 -cidr 192.168.0.0/16
```

## 命令行选项

| 标志    | 描述                                      | 默认值  |
| ------- | ----------------------------------------- | ------- |
| `-i`    | 要监控的网络接口                          | `br0`   |
| `-l`    | Web UI 监听地址 (例如 `:8000`)            | (禁用)  |
| `-lan`  | 启用局域网流量监控 (默认忽略)             | `false` |
| `-cidr` | 自定义要忽略的网段 (可重复)               | 无      |
| `-x`    | XDP 模式 (auto, generic, driver, offload) | `auto`  |
| `-s`    | 统计同步间隔 (秒)                         | `1`     |

## Web UI 功能

- **客户端列表**: 查看所有活跃 IP 及其实时下载/上传速度。
- **详情视图**:
  - **会话统计**: 独立的会话计数器 (流量/时长)，可通过特定按钮重置。
  - **全局统计**: 历史总流量计数器。
  - **流列表**: 所有活跃连接的实时列表，包含本地/远程 IP 和端口。
- **控制**:
  - **自动刷新**: 暂停/恢复 实时更新。
  - **主题**: 切换 深色/浅色 模式。
  - **IP 信息**: 选择首选 IP 地理位置提供商 (ipinfo.io, ipapi.is, 等)。

## 许可证

GPL 2.0
